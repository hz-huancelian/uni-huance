(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/index/index"],{"35a8":function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=s(n("a34a"));function s(e){return e&&e.__esModule?e:{default:e}}function r(e,t,n,o,s,r,i){try{var c=e[r](i),u=c.value}catch(a){return void n(a)}c.done?t(u):Promise.resolve(u).then(o,s)}function i(e){return function(){var t=this,n=arguments;return new Promise((function(o,s){var i=e.apply(t,n);function c(e){r(i,o,s,c,u,"next",e)}function u(e){r(i,o,s,c,u,"throw",e)}c(void 0)}))}}var c={data:function(){return{title:"环测链",wxLogin:"微信登录",accountLogin:"账号登录"}},onLoad:function(){var t=this;e.login({provider:"weixin",success:function(n){t.$api.doSlientLogin({code:n.code},(function(n){if(200===n.code){var o=n.result,s=o.Authorization,r=o.sign;if(0===+r)return t.$db.set("userToken",s),t.$db.set("TOKEN",s),t.$db.set("SIGN",r),t.getUserInfo(),!1;e.login({provider:"weixin",success:function(e){t.$api.auth({code:e.code},(function(e){if(e.success){var n=e.result,o=n.openid,r=n.session_key;return t.$db.set("userToken",s),t.$db.set("openid",o),t.$db.set("session_key",r),t.$db.set("SIGN",1),!1}}))}})}}))}})},methods:{navigateToAccountLogin:function(){e.navigateTo({url:"/pages/login/index"})},getUserPhone:function(t){var n=this;if(t.detail.code){var s=t.detail,r=s.encryptedData,c=s.iv,u=(s.code,this.$db.get("openid")),a=this.$db.get("session_key"),d={encryptedData:r,iv:c,openId:u,sessionKey:a};this.$api.doLogin(d,function(){var t=i(o.default.mark((function t(s){return o.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!s.success){t.next=7;break}return n.$db.set("userToken",s.result),n.$db.set("TOKEN",s.result),t.next=5,n.getUserInfo();case 5:t.next=8;break;case 7:e.showToast({title:s.message,icon:"none"});case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}else e.showToast({title:"登录授权失败",icon:"none"})},wxToAccountLogin:function(t){var n=this;e.getUserProfile({lang:"zh_CN",desc:"登录",success:function(t){var s=t.encryptedData,r=t.iv,c=n.$db.get("openid"),u=n.$db.get("session_key"),a={encryptedData:s,iv:r,openId:c,sessionKey:u};n.$api.doLogin(a,function(){var t=i(o.default.mark((function t(s){return o.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!s.success){t.next=7;break}return n.$db.set("userToken",s.result),n.$db.set("TOKEN",s.result),t.next=5,n.getUserInfo();case 5:t.next=8;break;case 7:e.showToast({title:s.message,icon:"none"});case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())},fail:function(t){e.showToast({title:"登录授权失败",icon:"none"})}})},getUserInfo:function(){var t=this;this.$api.getUserInfo((function(n){if(n.success&&n.result){if(t.$store.commit("SAVE_CUR_USER",n.result),n.result.appRoles.length>0)switch(t.$store.commit("SAVE_ROLE_LISTS",n.result.appRoles),n.result.appRoles[0]){case"2":t.$store.commit("SAVE_CUR_ROLE",{roleId:2,roleName:"采样员"});break;case"1":t.$store.commit("SAVE_CUR_ROLE",{roleId:1,roleName:"采样组长"});break;default:t.$store.commit("SAVE_CUR_ROLE",{})}else t.$store.commit("SAVE_ROLE_LISTS",n.result.appRoles);e.switchTab({url:"/pages/task/index"})}else t.$common.errorToShow(n.result)}))}}};t.default=c}).call(this,n("543d")["default"])},"3f25":function(e,t,n){"use strict";n.r(t);var o=n("35a8"),s=n.n(o);for(var r in o)"default"!==r&&function(e){n.d(t,e,(function(){return o[e]}))}(r);t["default"]=s.a},6009:function(e,t,n){"use strict";var o;n.d(t,"b",(function(){return s})),n.d(t,"c",(function(){return r})),n.d(t,"a",(function(){return o}));var s=function(){var e=this,t=e.$createElement;e._self._c},r=[]},"680d":function(e,t,n){"use strict";var o=n("73ce"),s=n.n(o);s.a},"6b4e":function(e,t,n){"use strict";n.r(t);var o=n("6009"),s=n("3f25");for(var r in s)"default"!==r&&function(e){n.d(t,e,(function(){return s[e]}))}(r);n("680d");var i,c=n("f0c5"),u=Object(c["a"])(s["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],i);t["default"]=u.exports},"73ce":function(e,t,n){},c762:function(e,t,n){"use strict";(function(e){n("88c8");o(n("66fd"));var t=o(n("6b4e"));function o(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,n("543d")["createPage"])}},[["c762","common/runtime","common/vendor"]]]);