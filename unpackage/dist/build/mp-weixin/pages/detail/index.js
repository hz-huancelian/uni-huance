(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/detail/index"],{"063b":function(e,t,a){"use strict";var s=a("2c71"),o=a.n(s);o.a},"0ee2":function(e,t,a){"use strict";a.r(t);var s=a("8adc"),o=a.n(s);for(var i in s)"default"!==i&&function(e){a.d(t,e,(function(){return s[e]}))}(i);t["default"]=o.a},"11c3":function(e,t,a){"use strict";a.r(t);var s=a("28f3"),o=a.n(s);for(var i in s)"default"!==i&&function(e){a.d(t,e,(function(){return s[e]}))}(i);t["default"]=o.a},2104:function(e,t,a){"use strict";a.d(t,"b",(function(){return o})),a.d(t,"c",(function(){return i})),a.d(t,"a",(function(){return s}));var s={uniForms:function(){return Promise.all([a.e("common/vendor"),a.e("uni_modules/uni-forms/components/uni-forms/uni-forms")]).then(a.bind(null,"d396"))},uniFormsItem:function(){return Promise.all([a.e("common/vendor"),a.e("uni_modules/uni-forms/components/uni-forms-item/uni-forms-item")]).then(a.bind(null,"fca1"))}},o=function(){var e=this,t=e.$createElement;e._self._c},i=[]},"28f3":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=function(){a.e("components/w-picker/w-picker").then(function(){return resolve(a("cd20"))}.bind(null,a)).catch(a.oe)},o=function(){Promise.all([a.e("common/vendor"),a.e("uni_modules/uni-data-checkbox/components/uni-data-checkbox/uni-data-checkbox")]).then(function(){return resolve(a("83a4"))}.bind(null,a)).catch(a.oe)},i={components:{uniDataCheckbox:o,wPicker:s},props:{item:{type:Object,default:[]},editable:{type:Boolean,default:!0}},data:function(){return{measured:"",visible:!1,visible2:!1,visible3:!1,visible4:!1,visible5:!1,defaultRegion:[],measuredFormData:{firstVal:"",secondVal:"",avgVal:""}}},options:{styleIsolation:"shared"},created:function(){},methods:{}};t.default=i},"2b9f":function(e,t,a){"use strict";var s=a("ab8c"),o=a.n(s);o.a},"2c71":function(e,t,a){},4424:function(e,t,a){"use strict";a.r(t);var s=a("2104"),o=a("11c3");for(var i in o)"default"!==i&&function(e){a.d(t,e,(function(){return o[e]}))}(i);a("2b9f");var n,r=a("f0c5"),l=Object(r["a"])(o["default"],s["b"],s["c"],!1,null,"10801ba5",null,!1,s["a"],n);t["default"]=l.exports},"5d70":function(e,t,a){"use strict";(function(e){a("88c8");s(a("66fd"));var t=s(a("b721"));function s(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,a("543d")["createPage"])},8394:function(e,t,a){"use strict";a.d(t,"b",(function(){return o})),a.d(t,"c",(function(){return i})),a.d(t,"a",(function(){return s}));var s={uniPopup:function(){return a.e("uni_modules/uni-popup/components/uni-popup/uni-popup").then(a.bind(null,"804b"))},uniEasyinput:function(){return a.e("uni_modules/uni-easyinput/components/uni-easyinput/uni-easyinput").then(a.bind(null,"1288"))}},o=function(){var e=this,t=e.$createElement,a=(e._self._c,Math.random());e.$mp.data=Object.assign({},{$root:{g0:a}})},i=[]},"8adc":function(e,t,a){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;o(a("d954"));var s=o(a("4424"));function o(e){return e&&e.__esModule?e:{default:e}}function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var n=function(){a.e("pages/detail/column-factor").then(function(){return resolve(a("dc69"))}.bind(null,a)).catch(a.oe)},r=function(){Promise.all([a.e("common/vendor"),a.e("pages/detail/column")]).then(function(){return resolve(a("6404"))}.bind(null,a)).catch(a.oe)},l=function(){a.e("pages/detail/upload").then(function(){return resolve(a("9345"))}.bind(null,a)).catch(a.oe)},u=function(){a.e("pages/detail/upload-detail").then(function(){return resolve(a("3c93"))}.bind(null,a)).catch(a.oe)},c=function(){a.e("pages/detail/position").then(function(){return resolve(a("f1a4"))}.bind(null,a)).catch(a.oe)},m=function(){a.e("pages/detail/specialRemark").then(function(){return resolve(a("0448"))}.bind(null,a)).catch(a.oe)},p=function(){a.e("pages/detail/reviewUser").then(function(){return resolve(a("b892"))}.bind(null,a)).catch(a.oe)},f={components:{columnFactor:n,column:r,upload:l,uploadDetail:u,position:c,specialRemark:m,reviewUser:p,pollistView:s.default},data:function(){var e;return e={sampItemId:"",sampleNo:"",editable:"",frequency:"",title:"",detailStatus:"",sampleInfo:{},pageTitle:"",approveText:"fdsf",name:"",unit:"",sampleNums:"",reviewedNums:"",waitingConfirmedNums:"",hasConfirmedNums:"",collectedNums:"",fileList:[],address:""},i(e,"detailStatus",""),i(e,"currentfactorDataVos",[]),i(e,"checkEquipments",[]),i(e,"allReviewers",[]),i(e,"checkShow",[]),i(e,"showBackVisible",!1),i(e,"errorResult",""),i(e,"backReason",""),i(e,"opType",""),i(e,"butDisabled",!1),i(e,"isScanOper",!1),i(e,"factorShow",!1),i(e,"showPollist",!1),i(e,"pollist",[]),e},computed:{projectInfo:function(){return this.sampleInfo.sampleJobVo||{}},factorDataVos:function(){var e=this.sampleInfo.factorDataVos?this.sampleInfo.factorDataVos.filter((function(e){return"1"===e.dataEntryStep})):[];return e||[]},specialNote:function(){return{specialNoteFlag:this.sampleInfo.sampleDataVo&&this.sampleInfo.sampleDataVo.specialNoteFlag||!1,specialNote:this.sampleInfo.sampleDataVo&&this.sampleInfo.sampleDataVo.specialNote||""}},reviewUser:function(){return this.sampleInfo.sampleDataVo&&this.sampleInfo.sampleDataVo.reviewUser||""},reviewUserId:function(){return this.sampleInfo.sampleDataVo&&this.sampleInfo.sampleDataVo.reviewUserId||""},sampleDataVo:function(){var e=this,t=null;return this.sampleInfo.sampleDataVo&&this.sampleInfo.sampleDataVo.sampleData&&(t=this.sampleInfo.sampleDataVo.sampleData,t.forEach((function(t){var a=t.params||[];a.forEach((function(t){"collectDate"===t.key&&(t.value=e.sampleInfo.sampleDataVo.collectDate)}))}))),t||[]}},onLoad:function(e){this.butDisabled=!1,e.sampleNo&&(this.sampleNo=e.sampleNo,this.editable=e.editable||"",this.title=e.title||"",this.detailStatus=e.detailStatus||"",this.isScanOper=!0),e.sampItemId&&(this.sampItemId=e.sampItemId,this.editable=e.editable||"",this.title=e.title||"",this.detailStatus=e.detailStatus||"",this.isScanOper=!1,this.getCheckEquip())},onShow:function(){this.getReviewUsers(),this.isScanOper?this.getSampleForNo():this.queryDetail()},mounted:function(){e.setNavigationBarTitle({title:this.title})},methods:{getCheckEquip:function(){var e=this;this.$api.commonForGet("sample/listCheckEquipments/"+this.sampItemId,(function(t){200===t.code&&(e.checkEquipments=t.result||[])}))},tabClick:function(e){this.tabIndex=e,console.log("当前切换下标是".concat(this.tabIndex))},getSampleForNo:function(){var e=this;this.$api.getSampleForNo("sample/getSampleDetailBySampleNo/"+this.sampleNo,(function(t){if(200===t.code){e.sampleInfo=t.result||{},e.sampItemId=t.result.sampItemId,e.address=t.result.sampleDataVo.collectLocation||"",e.frequency=t.result.frequency||"";var a=t.result.sampleDataVo.imageList||[];a&&(e.fileList=a.map((function(e){var t={name:e,extname:e.split(".")[1],url:"http://www.huancelian.com/cyImg/".concat(e)};return t}))),t.result.sampleDataVo.pollutantInfo&&t.result.sampleDataVo.pollutantInfo.length>0&&(e.pollist=JSON.parse(t.result.sampleDataVo.pollutantInfo)||[]),e.getFactorInfo(t.result),e.getCheckEquip()}}))},queryDetail:function(){var e=this;this.$api.getSampleForId("sample/detail/"+this.sampItemId,(function(t){if(200===t.code){e.sampleInfo=t.result||{},e.address=t.result.sampleDataVo.collectLocation||"",e.frequency=t.result.frequency||"";var a=t.result.sampleDataVo.imageList||[];a&&(e.fileList=a.map((function(e){var t={name:e,extname:e.split(".")[1],url:"http://www.huancelian.com/cyImg/".concat(e)};return t}))),t.result.sampleDataVo.pollutantInfo&&t.result.sampleDataVo.pollutantInfo.length>0&&(e.pollist=JSON.parse(t.result.sampleDataVo.pollutantInfo)||[]),e.getFactorInfo(t.result)}}))},getFactorInfo:function(e){this.checkShow=[],this.factorShow=!1;var t=[],a=e.secdClassId;"001001"===a||"001004"===a?(t=["isPop","checkEquipment","positioningTwo","positioningThree","positioningOne"],this.factorShow=!0):"002002"===a||"0020022"===a?(t=["isFactor"],this.pollist&&this.pollist.length<=0&&(this.pollist=[{pollutant:"",gasProduction:"",gasFlow:"",gasVolume:"",standardVolume:"",thermometers:"",pressureGauge:""}]),this.showPollist=!0,this.factorShow=!0):"001002"===a||"001003"===a?(t=["isPop","checkEquipment","groundConditions"],this.factorShow=!0):"002005"!==a&&"002003"!==a&&"002004"!==a&&"002001"!==a||(t=["isFactor"],this.factorShow=!0),this.checkShow=t},formCheck:function(e){var t=[];e.forEach((function(e){e.params&&(t=t.concat(e.params))}));var a=t.find((function(e){if(e.required&&(!e.value||""===e.value||0==e.value.length))return e}));return!(!a||void 0===a)},getSampItemDetail:function(){var e=this,t=this.sampleDataVo.map((function(e){return e.groupKey})),a=t.map((function(t){var a=e.$refs["column_"+t][0];return a.formData})),s="",o="",i="";a&&a.forEach((function(e){e.collectDate&&(s=e.collectDate),e.sampleProperties&&(o=e.sampleProperties),e.sampleFixative&&(i=e.sampleFixative)}));var n=this.$refs.specialNote&&this.$refs.specialNote.specialRemark||"",r=this.constructorSampleData(a),l=[];this.$refs.upload&&this.$refs.upload.getData()&&(l=this.$refs.upload.getData().map((function(e){return e.succImg})));var u=this.$refs.position?this.$refs.position.position:"",c=this.$refs.reviewUser?this.$refs.reviewUser.userId:"",m=this.getFactorList(),p=this.getPollutants(),f={};return this.setOuterCollectParams(f,r,n),f.sampleItemId=this.sampleInfo.sampItemId,f.collectLocation=u,f.sampleData=JSON.stringify(r),f.sampleDataValue=this.constructorSampleDataValue(r,n),f.imageList=l,f.reviewUserId=c,f.collectDate=s,f.sampleProperties=o,f.sampleFixative=i,f.factorDataVos=m,f.pollutantInfo=p,f},submit:function(){var e=this;this.butDisabled=!0;var t=this.getSampItemDetail();if(!this.$refs.reviewUser||""===this.$refs.reviewUser.userId)return this.$common.errorToShow("复核人不能为空!"),void(this.butDisabled=!1);var a=this.formCheck(JSON.parse(t.sampleData));if(a)return this.$common.errorToShow("当前有必填项未录入信息!"),void(this.butDisabled=!1);try{this.$api.saveSampItemDetail(t,(function(t){200==t.code?e.goToSubmit():(e.$common.errorToShow(t.message),e.butDisabled=!1)}))}catch(s){this.butDisabled=!1,this.$common.errorToShow("提交操作异常!")}},goToSubmit:function(){var t=this;this.$api.submitSampItemDetail({sampleItemId:this.sampItemId},(function(a){200===a.code?(t.$common.successToShow("提交成功"),e.switchTab({url:"/pages/task/index"})):t.$common.errorToShow(a.result||a.message),t.butDisabled=!1}),(function(e){t.butDisabled=!1,t.$common.errorToShow(e)})),setTimeout((function(){t.butDisabled=!1}),3e3)},saveSample:function(){this.butDisabled=!0;var e=this.getSampItemDetail();"1"!==this.frequency||e.collectDate&&""!==e.collectDate?this.saveSampItemDetail(e):this.$common.errorToShow("当天第一个样品的采样日期不能为空")},getPollutants:function(){var e=this,t=[];return this.pollist&&this.pollist.length>0?(this.pollist.forEach((function(a,s){if(e.$refs["pollistRef_"+s]&&e.$refs["pollistRef_"+s].length>0){var o=e.$refs["pollistRef_"+s];o&&t.push(o[0].item)}})),JSON.stringify(t)):""},getFactorList:function(){var e=this,t=[];return this.factorDataVos.forEach((function(a,s){if(e.$refs["factor_column_"+s]&&e.$refs["factor_column_"+s].length>0){var o=e.$refs["factor_column_"+s][0].factorInfo;if(JSON.parse(o.factorData)==o.factorData){var i=[{desc:"结果值",val:o.factorData}];o.factorDataValue=JSON.stringify(i)}else o.factorDataValue=o.factorData;t.push(o)}})),t},constructorSampleDataValue:function(e,t){var a={},s=JSON.parse(JSON.stringify(this.sampleDataVo)),o=s.map((function(t){for(var a=t.groupKey,s=0;s<e.length;s++)if(e[s].groupKey===a)for(var o=function(a){var o=e[s].params.find((function(e){return e.key===t.params[a].key}));t.params[a].value=o.value||""},i=0;i<t.params.length;i++)o(i);return t}));if(o.forEach((function(e){e.params=e.params.forEach((function(e){var t={numericType:e.numericType,value:[{desc:e.name,val:e.value}]};a[e.key]=t}))})),t&&""!==t){var i=JSON.parse(t);a.heatBox={numericType:"0",value:[{desc:"保温箱是否完整",val:i.heatBox||""}]},a.temperature={numericType:"1",value:[{desc:"接收时保温箱内温度",val:i.temperature||""}]},a.sampleComplete={numericType:"0",value:[{desc:"样品瓶是否完整",val:i.sampleComplete||""}]}}return JSON.stringify(a)},constructorSampleData:function(e){var t=JSON.parse(JSON.stringify(e)),a=JSON.parse(JSON.stringify(this.sampleDataVo)),s=a.map((function(e){for(var a=e.groupKey,s=0;s<t.length;s++)if(t[s].columnKey===a)for(var o=0;o<e.params.length;o++)e.params[o].value=t[s][e.params[o].key];return e}));return s=s.map((function(e){return e.params=e.params.map((function(e){return e.selectValue&&delete e.selectValue,e.radioValue&&delete e.radioValue,e})),e})),s},setOuterCollectParams:function(e,t,a){for(var s=t.filter((function(e){var t=e.params.map((function(e){return e.key}));return t.includes("collectDate")})),o=s[0]&&s[0].params||[],i=0;i<o.length;i++)e[o[i]["key"]]=o[i]["value"];a&&(e.specialNote=a)},saveSampItemDetail:function(t){var a=this;this.$api.saveSampItemDetail(t,(function(t){a.butDisabled=!1,200===t.code?(a.$common.successToShow("操作成功！"),e.switchTab({url:"/pages/task/index"})):a.$common.errorToShow(t.message)}))},getReviewUsers:function(){var e=this;this.$api.getReviewUsers((function(t){var a=[];t.result.forEach((function(t){if(e.$store.getters.userInfo.userId!==t.userId){var s={value:t.userId,label:t.empName};a.push(s)}})),e.allReviewers=a}))},reviewBackDialog:function(){this.$refs.backResult.open()},cancleResult:function(){this.$refs.backResult.close()},confirmResult:function(){var t=this;if(this.butDisabled=!0,this.$refs.backResult.close(),this.butDisabled=!0,1==this.opType){var a={sampItemId:this.sampItemId,auditFlag:"2",auditReason:this.backReason};this.$api.reviewSampleItem(a,(function(a){t.butDisabled=!1,200===a.code?(t.$common.successToShow("操作成功！"),e.switchTab({url:"/pages/task/index"})):t.$common.errorToShow(a.message)}))}else if(2==this.opType){var s={sampItemId:this.sampItemId,auditFlag:2,auditReason:this.backReason};this.$api.auditSampleItem(s,(function(a){t.butDisabled=!1,200==a.code?(t.$common.successToShow("操作成功！"),e.switchTab({url:"/pages/task/index"})):t.$common.errorToShow(a.message)}))}},reviewBack:function(){this.opType=1,this.backReason="",this.$refs.backResult.open()},reviewSubmit:function(){var t=this;this.butDisabled=!0;var a={sampItemId:this.sampItemId,auditFlag:"1",auditReason:""};this.$api.reviewSampleItem(a,(function(a){t.butDisabled=!1,200===a.code?(t.$common.successToShow("操作成功！"),e.switchTab({url:"/pages/task/index"})):t.$common.errorToShow(a.message)}))},backPage:function(){e.switchTab({url:"/pages/task/index"})},auditSampleBack:function(){this.opType=2,this.backReason="",this.$refs.backResult.open()},auditSampleSubmit:function(){var t=this;this.butDisabled=!0;var a={sampItemId:this.sampItemId,auditFlag:1,auditReason:""};this.$api.auditSampleItem(a,(function(a){t.butDisabled=!1,200==a.code?(t.$common.successToShow("操作成功！"),e.switchTab({url:"/pages/task/index"})):t.$common.errorToShow(a.message)}))},applySubmit:function(){var t=this;this.butDisabled=!0;var a={sampleItemId:this.sampItemId};this.$api.sampStoreApply(JSON.stringify(a),(function(a){t.butDisabled=!1,200==a.code?(t.$common.successToShow("操作成功！"),e.switchTab({url:"/pages/task/index"})):t.$common.errorToShow(a.message)}))},addResult:function(){var e=this,t=[];this.pollist.forEach((function(a,s){if(e.$refs["pollistRef_"+s]&&e.$refs["pollistRef_"+s].length>0){var o=e.$refs["pollistRef_"+s];o&&t.push(o[0].item)}})),t.push({pollutant:"",gasProduction:"",gasFlow:"",gasVolume:"",standardVolume:"",thermometers:"",pressureGauge:""}),this.pollist=t},deleResult:function(e){var t=this,a=[];this.pollist.forEach((function(s,o){if(o!==e){var i=t.$refs["pollistRef_"+o];i&&a.push(i[0].item)}})),this.pollist=a}}};t.default=f}).call(this,a("543d")["default"])},ab8c:function(e,t,a){},b721:function(e,t,a){"use strict";a.r(t);var s=a("8394"),o=a("0ee2");for(var i in o)"default"!==i&&function(e){a.d(t,e,(function(){return o[e]}))}(i);a("063b");var n,r=a("f0c5"),l=Object(r["a"])(o["default"],s["b"],s["c"],!1,null,"4d70ade0",null,!1,s["a"],n);t["default"]=l.exports}},[["5d70","common/runtime","common/vendor"]]]);